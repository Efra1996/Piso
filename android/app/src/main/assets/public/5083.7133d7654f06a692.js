"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5083],{5083:(A,h,u)=>{u.r(h),u.d(h,{ProductosPageModule:()=>O});var f=u(6814),d=u(95),a=u(1024),_=u(6958),b=u(5861),o=u(6689),P=u(3590);function C(n,l){if(1&n){const i=o.EpF();o.TgZ(0,"ion-list")(1,"ion-item",14)(2,"ion-text",15),o._uU(3),o.qZA(),o.TgZ(4,"ion-segment",16),o.NdJ("ionChange",function(e){const s=o.CHM(i).$implicit,p=o.oxw();return o.KtG(p.cambiaEstado(e,s.nombre,s.precio))}),o.TgZ(5,"ion-segment-button",17)(6,"ion-label",18),o._uU(7,"Apuntar"),o.qZA()(),o.TgZ(8,"ion-segment-button",17)(9,"ion-label",19),o._uU(10,"Comprado"),o.qZA()()()()()}if(2&n){const i=l.$implicit;o.xp6(3),o.Oqu(i.nombre),o.xp6(1),o.Q6J("value",i.comprado),o.xp6(1),o.Q6J("value",!1),o.xp6(3),o.Q6J("value",!0)}}function x(n,l){if(1&n){const i=o.EpF();o.TgZ(0,"div",20)(1,"h1"),o._uU(2,"Nuevo Producto"),o.qZA(),o.TgZ(3,"form",21)(4,"ion-list",22)(5,"ion-item"),o._UZ(6,"ion-input",23),o.qZA(),o.TgZ(7,"ion-item"),o._UZ(8,"ion-input",24),o.qZA(),o.TgZ(9,"ion-item",25)(10,"ion-button",26),o.NdJ("click",function(){o.CHM(i);const e=o.oxw();return o.KtG(e.nuevoProducto())}),o._UZ(11,"ion-icon",27),o.qZA()()()()()}if(2&n){const i=o.oxw();o.xp6(3),o.Q6J("formGroup",i.formReg)}}function Z(n,l){if(1&n&&(o.TgZ(0,"ion-item",38)(1,"ion-label",2),o._uU(2),o.qZA(),o.TgZ(3,"ion-label",30),o._uU(4),o.qZA()()),2&n){const i=l.$implicit;o.xp6(2),o.Oqu(i.nombre),o.xp6(2),o.hij("",i.precio,"\u20ac")}}function T(n,l){if(1&n){const i=o.EpF();o.TgZ(0,"div",1)(1,"h1",28),o._uU(2,"Revisa la compra"),o.qZA(),o.TgZ(3,"ion-list"),o.YNc(4,Z,5,2,"ion-item",29),o.TgZ(5,"ion-item",22)(6,"ion-label",30),o._uU(7),o.qZA()(),o.TgZ(8,"ion-item",22)(9,"ion-select",31),o.NdJ("ionChange",function(e){o.CHM(i);const r=o.oxw();return o.KtG(r.elegirPagador(e))}),o.TgZ(10,"ion-select-option",32),o._uU(11,"Efra"),o.qZA(),o.TgZ(12,"ion-select-option",33),o._uU(13,"Mar\xeda"),o.qZA()()(),o.TgZ(14,"ion-item",34)(15,"ion-button",35),o.NdJ("click",function(){o.CHM(i);const e=o.oxw();return o.KtG(e.realizaraCompra())}),o._UZ(16,"ion-icon",27),o.qZA(),o.TgZ(17,"ion-button",36),o.NdJ("click",function(){o.CHM(i);const e=o.oxw();return o.KtG(e.setOpenPagador(!1))}),o._UZ(18,"ion-icon",37),o.qZA()()()()}if(2&n){const i=o.oxw();o.xp6(4),o.Q6J("ngForOf",i.productosComprados),o.xp6(3),o.hij("Total: ",i.calcularTotal(),"\u20ac"),o.xp6(8),o.Q6J("disabled",""===i.nombrePagador)}}const M=[{path:"",component:(()=>{var n;class l{constructor(t,e,r){this.fb=t,this.firebase=e,this.toastController=r,this.isModalOpen=!1,this.cambios=!0,this.openPersona=!1,this.nombrePagador="",this.formReg=this.fb.group({precio:new d.NI("",d.kI.required),nombre:new d.NI("",d.kI.required)}),this.listaCompra=[],this.productosComprados=[],this.productos=[],this.productosActualizados=[],this.allProducts()}ngOnInit(){}nuevoProducto(){this.firebase.nuevoProducto(this.formReg.value.nombre,this.formReg.value.precio,!1).then(()=>{this.allProducts()}),this.productos.push({nombre:this.formReg.value.nombre,precio:this.formReg.value.precio,comprado:!1}),this.isModalOpen=!1}setOpen(t){this.isModalOpen=t}setOpenPagador(t){this.openPersona=t}pulsarFuera(t){this.openPersona=!1,this.isModalOpen=!1,console.log(this.openPersona)}allProducts(){this.productos=[],this.firebase.recuperarTodosProductos().then(t=>{t.map(e=>{this.productos.push({nombre:e.nombre,precio:e.precio,comprado:e.comprado})}),this.productos=this.productos.sort((e,r)=>e.nombre.localeCompare(r.nombre))}).catch()}cambiaEstado(t,e,r){const s=t.detail.value;console.log(t);const p=this.productosActualizados.findIndex(c=>c.nombre===e);if(-1!==p&&this.productosActualizados.splice(p,1),this.productosActualizados.push({nombre:e,precio:r,comprado:s}),!1===s){const c=this.listaCompra.findIndex(m=>m.nombre===e);-1!==c?this.listaCompra.splice(c,1):this.listaCompra.push({nombre:e,precio:r,comprado:s})}else{const c=this.productosComprados.findIndex(m=>m.nombre===e);-1!==c?this.productosComprados.splice(c,1):this.productosComprados.push({nombre:e,precio:r,comprado:s})}this.cambios=!this.comrpobarCambios(),console.log(this.productosActualizados,this.listaCompra,this.cambios)}guardarCambios(){this.comrpobarCambios()?this.productosActualizados.find(e=>!0===e.comprado)?this.openPersona=!0:this.firebase.actualizarEstado(this.listaCompra).then(()=>{this.listaCompra=[],this.mostrarToast("Pues toca ir a comprar! \u263a"),this.cambios=!0,this.allProducts()}):console.log("No hay cambios")}comrpobarCambios(){let t=0;return this.productosActualizados.map(e=>{const r=this.productos.find(s=>s.nombre===e.nombre);(!r||r.comprado!==e.comprado)&&t++}),t>0}elegirPagador(t){this.nombrePagador=t.detail.value}mostrarToast(t){var e=this;return(0,b.Z)(function*(){yield(yield e.toastController.create({message:t,duration:2e3,position:"bottom",color:"success",buttons:[{side:"end",icon:"close-outline",role:"cancel",handler:()=>{console.log("Cerrar toast")}}]})).present()})()}calcularTotal(){return this.productosComprados.reduce((t,e)=>t+e.precio,0)}realizaraCompra(){var t=this;const e=this.calcularTotal();this.firebase.historialCompra(this.nombrePagador,this.productosComprados,e,this.obtenerFechaYHoraActual()).then(()=>{this.firebase.actualizarEstado(this.productosComprados).then((0,b.Z)(function*(){yield t.actualizarSaldos(t.nombrePagador,e),t.mostrarToast("Se ha realizado la compra!"),t.productosComprados=[],t.allProducts(),t.openPersona=!1,t.cambios=!0,t.nombrePagador=""}))})}obtenerFechaYHoraActual(){const t=new Date,e=t.getDate(),r=t.getMonth()+1,s=t.getFullYear(),p=t.getHours(),c=t.getMinutes();return`${e}/${r}/${s} ${p}:${c<10?"0"+c:c}`}doRefresh(t){this.cambios=!0,this.listaCompra=[],this.productosComprados=[],this.allProducts(),setTimeout(()=>{console.log("Recarga completada"),t.target.complete()},2e3)}actualizarSaldos(t,e){let r,s;const p=e/2;let c=[];this.firebase.recuperarSaldo().then(m=>{c=m,r=c.find(g=>g.nombre===t),s=c.find(g=>g.nombre!==t),r.saldo=r.saldo+p,s.saldo=s.saldo-p,this.recorrerCuentasCambiandoSaldos(c)}).catch()}recorrerCuentasCambiandoSaldos(t){t.forEach(e=>{this.firebase.actualizarSaldo(e.nombre,e.saldo).then(()=>{})})}}return(n=l).\u0275fac=function(t){return new(t||n)(o.Y36(d.qu),o.Y36(P.O),o.Y36(a.yF))},n.\u0275cmp=o.Xpm({type:n,selectors:[["app-productos"]],decls:25,vars:6,consts:[[3,"translucent"],[1,"ion-text-uppercase"],["slot","start"],["color","secondary"],[1,"center-title"],[1,"ion-padding",3,"fullscreen"],["slot","fixed",3,"ionRefresh"],["color","secondary",3,"click"],["slot","start","name","add-sharp"],["color","secondary","expand","full",3,"disabled","click"],["slot","start","name","save-sharp"],[4,"ngFor","ngForOf"],["id","example-modal",3,"isOpen","ionModalDidDismiss"],["modal",""],[2,"color","white"],[2,"width","150px"],["color","light","mode","ios",3,"value","ionChange"],[3,"value"],["color","danger"],["color","success"],[1,"wrapper"],[3,"formGroup"],["lines","none"],["label","Nombre","formControlName","nombre"],["label","Precio","type","number","formControlName","precio"],[1,"ion-align-items-center"],["fill","clear",2,"margin-left","100px",3,"click"],["name","checkmark"],[2,"text-align","center"],["lines","full",4,"ngFor","ngForOf"],["slot","end"],["aria-label","Persona","interface","popover","placeholder","Elige al pringado que paga",3,"ionChange"],["value","efra"],["value","mar\xeda"],["lines","none",2,"display","flex","justify-content","space-around"],["fill","clear","color","success","slot","start",2,"flex","1",3,"disabled","click"],["fill","clear","color","danger","slot","end",2,"flex","1",3,"click"],["name","close"],["lines","full"]],template:function(t,e){1&t&&(o.TgZ(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),o._UZ(3,"ion-menu-button",3),o.qZA(),o.TgZ(4,"ion-title",4),o._uU(5,"Lista de la compra"),o.qZA()()(),o.TgZ(6,"ion-content",5)(7,"ion-refresher",6),o.NdJ("ionRefresh",function(s){return e.doRefresh(s)}),o._UZ(8,"ion-refresher-content"),o.qZA(),o.TgZ(9,"ion-grid")(10,"ion-row")(11,"ion-col")(12,"ion-button",7),o.NdJ("click",function(){return e.setOpen(!0)}),o._UZ(13,"ion-icon",8),o._uU(14," Nuevo producto "),o.qZA()(),o.TgZ(15,"ion-col")(16,"ion-button",9),o.NdJ("click",function(){return e.guardarCambios()}),o._UZ(17,"ion-icon",10),o._uU(18," Guardar "),o.qZA()()()(),o.YNc(19,C,11,4,"ion-list",11),o.TgZ(20,"ion-modal",12,13),o.NdJ("ionModalDidDismiss",function(s){return e.pulsarFuera(s)}),o.YNc(22,x,12,1,"ng-template"),o.qZA(),o.TgZ(23,"ion-modal",12),o.NdJ("ionModalDidDismiss",function(s){return e.pulsarFuera(s)}),o.YNc(24,T,19,3,"ng-template"),o.qZA()()),2&t&&(o.Q6J("translucent",!0),o.xp6(6),o.Q6J("fullscreen",!0),o.xp6(10),o.Q6J("disabled",e.cambios),o.xp6(3),o.Q6J("ngForOf",e.productos),o.xp6(1),o.Q6J("isOpen",e.isModalOpen),o.xp6(3),o.Q6J("isOpen",e.openPersona))},dependencies:[f.sg,d._Y,d.JJ,d.JL,a.YG,a.Sm,a.wI,a.W2,a.jY,a.Gu,a.gu,a.pK,a.Ie,a.Q$,a.q_,a.fG,a.nJ,a.Wo,a.Nd,a.cJ,a.GO,a.t9,a.n0,a.yW,a.wd,a.sr,a.ki,a.as,a.QI,a.j9,d.sg,d.u],styles:["ion-content[_ngcontent-%COMP%]{--ion-background-color: #1e1e1e}ion-toolbar[_ngcontent-%COMP%]{--ion-background-color: #1e1e1e}ion-modal#example-modal[_ngcontent-%COMP%]{--width: fit-content;--min-width: 250px;--height: fit-content;--border-radius: 6px;--box-shadow: 0 28px 48px rgba(0, 0, 0, .4)}ion-modal#example-modal[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:20px 20px 10px}ion-modal#example-modal[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-right:6px;width:48px;height:48px;padding:4px 0;color:#aaa}ion-modal#example-modal[_ngcontent-%COMP%]   .wrapper[_ngcontent-%COMP%]{margin-bottom:10px}.center-title[_ngcontent-%COMP%]{text-align:center;width:100%;color:#f0f0f0;font-family:Roboto,sans-serif;font-weight:700;font-size:25px}ion-segment-button[_ngcontent-%COMP%]::part(indicator-background){background:#fdfdfd}ion-segment-button.md[_ngcontent-%COMP%]::part(native){color:#000}.segment-button-checked.md[_ngcontent-%COMP%]::part(native){color:#fff}ion-segment-button.md[_ngcontent-%COMP%]::part(indicator-background){height:4px}ion-segment-button.ios[_ngcontent-%COMP%]::part(native){color:#08a391}.segment-button-checked.ios[_ngcontent-%COMP%]::part(native){color:#fff}ion-segment-button.ios[_ngcontent-%COMP%]::part(indicator-background){border-radius:20px}"]}),l})()}];let v=(()=>{var n;class l{}return(n=l).\u0275fac=function(t){return new(t||n)},n.\u0275mod=o.oAB({type:n}),n.\u0275inj=o.cJS({imports:[_.Bz.forChild(M),_.Bz]}),l})(),O=(()=>{var n;class l{}return(n=l).\u0275fac=function(t){return new(t||n)},n.\u0275mod=o.oAB({type:n}),n.\u0275inj=o.cJS({imports:[f.ez,d.u5,a.Pc,v,d.u5,d.UX]}),l})()}}]);